<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://www.authpro.com/auth/NaboriCorp/?action=pp"></script>
     <a href="https://www.authpro.com/auth/NaboriCorp/?action=logout">Logout</a>   
    <title>NABORI Corp - Student Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
        }

        body {
            background-color: #fdfdfc;
            min-height: 100vh;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        main {
            margin-top: 80px;
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .exam-card {
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            border-radius: 15px;
        }

        .question-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .1);
        }

        .timer {
            position: fixed;
            top: 70px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            z-index: 1000;
            display: none;
        }

        .correct-answer {
            background-color: #d4edda !important;
            border: 1px solid #c3e6cb !important;
        }

        .incorrect-answer {
            background-color: #f8d7da !important;
            border: 1px solid #f5c6cb !important;
        }

        .navbar-collapse {
            max-height: calc(100vh - 60px);
            overflow-y: auto;
        }

        /* Estilos del Chat Flotante */
        .chat-bubble {
            position: fixed;
            bottom: 40px;
            right: 30px;
            left: auto;
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .chat-bubble:hover {
            transform: scale(1.1);
        }

        .chat-bubble-icon {
            width: 60px;
            height: 60px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .chat-bubble-icon img {
            width: 70%;
            height: 70%;
        }

        .chat-container {
            position: fixed;
            bottom: 90px;
            right: 20px;
            left: auto;
            width: 350px;
            height: 550px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .chat-container.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.2em;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
        }

        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid #ddd;
            background: white;
            border-radius: 0 0 15px 15px;
        }

        .chat-input input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-bottom: 10px;
        }

        .chat-input button {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .user-message,
        .bot-message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            word-break: break-word;
            font-size: 0.9em;
        }

        .user-message {
            background: #e3f2fd;
            color: #1a73e8;
            margin-left: auto;
        }

        .bot-message {
            background: #f5f5f5;
            color: #0d652d;
            margin-right: auto;
        }

        @media (max-width: 480px) {
            .chat-container {
                width: 90vw;
                height: 70vh;
                right: 5vw;
                left: auto;
                bottom: 80px;
            }

            .chat-bubble {
                bottom: 10px;
                left: auto;
                right: 10px;
            }
        }

        @media (min-width: 992px) {
            .navbar-collapse {
                display: flex !important;
                flex-basis: auto;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">NABORI Corp SmartLMS</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard"><i class="fas fa-home"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#exams"><i class="fas fa-file-alt"></i> Ex√°menes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#grades"><i class="fas fa-chart-bar"></i> Calificaciones</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Timer -->
    <div class="timer">00:00</div>

    <!-- Chat Bubble -->
    <div class="chat-bubble" onclick="toggleChat()">
        <div class="chat-bubble-icon">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij48cGF0aCBkPSJNMjAgMkg0YTIgMiAwIDAgMC0yIDJ2MTJhMiAyIDAgMCAwIDIgMmg0bDQgNGw0LTRoNGEyIDIgMCAwIDAgMi0yVjRhMiAyIDAgMCAwLTItMnptLTIgMTRoLTRsLTQgNGwtNC00SDRWNmgxNnYxMHoiIGZpbGw9IndoaXRlIi8+PC9zdmc+"
                alt="Chat Icon">
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3>Tutor Mathy</h3>
            <button class="close-btn" onclick="toggleChat()">√ó</button>
        </div>
        <div class="chat-body" id="chatBody"></div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Escribe tu pregunta...">
            <button onclick="sendMessage()">Enviar</button>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main class="container-fluid">
        <!-- Dashboard -->
        <div class="container section active" id="dashboard">
            <h3 class="mb-4">Dashboard</h3>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="exam-card card bg-white p-4">
                        <h5><i class="fas fa-bell text-primary"></i> Pr√≥ximos Ex√°menes</h5>
                        <ul class="list-group mt-3" id="upcoming-exams"></ul>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="exam-card card bg-white p-4">
                        <h5><i class="fas fa-chart-line text-success"></i> Rendimiento</h5>
                        <canvas class="mt-3" id="performanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Exam List -->
        <div class="container section" id="exams">
            <h3 class="mb-4">Ex√°menes Disponibles</h3>
            <div class="list-group" id="exam-list"></div>
        </div>

        <!-- Grades Section -->
        <div class="container section" id="grades">
            <h3 class="mb-4">Historial de Calificaciones</h3>
            <button class="btn btn-primary mb-3" onclick="generatePDF()">
                <i class="fas fa-download"></i> Exportar a PDF
            </button>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Examen</th>
                        <th>Calificaci√≥n</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody id="grades-table"></tbody>
            </table>
        </div>
    </main>

    <!-- Exam Interface Modal -->
    <div class="modal fade" id="examModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="examTitle">Examen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="examQuestions"></div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="submitExam()">Entregar Examen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal fade" id="resultsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Resultados del Examen</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h5 class="mb-3">Estudiante: <span id="studentName"></span></h5>
                    <h5>Puntuaci√≥n: <span id="finalScore"></span>%</h5>
                    <h6>Tiempo restante: <span id="timeUsed"></span></h6>
                    <hr>
                    <div id="resultsDetails"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <script>
        // C√≥digo del Chat Bot
        const API_KEY = 'AIzaSyDWqEQB_l4HGiRY5G6RXppH7ajelOhx0dk';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent';

        let conversationHistory = [];
        let isProcessing = false;

        const initialPrompt = {
            role: "user",
            parts: [{
                text: "Eres un tutor experto en matem√°ticas, espa√±ol e ingl√©s. Reglas:\n" +
                    "1. Proporciona respuestas contextualizadas y √∫nicas\n" +
                    "2. Analiza profundamente cada pregunta\n" +
                    "3. Si no entiendes algo, pide clarificaci√≥n\n" +
                    "4. Var√≠a tus respuestas evitando repeticiones\n" +
                    "5. Adapta el lenguaje al nivel del usuario"
            }]
        };

        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.classList.toggle('active');
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const chatBody = document.getElementById('chatBody');
            const message = userInput.value.trim();

            if (!message) return;

            isProcessing = true;
            userInput.disabled = true;

            try {
                chatBody.innerHTML += `<div class="user-message">${message}</div>`;
                userInput.value = '';
                chatBody.scrollTop = chatBody.scrollHeight;

                const conversationContext = conversationHistory.length > 4
                    ? conversationHistory.slice(-4)
                    : conversationHistory;

                const fullContext = [initialPrompt, ...conversationContext, {
                    role: "user",
                    parts: [{ text: message }]
                }];

                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: fullContext,
                        generationConfig: {
                            temperature: 0.7,
                            topP: 0.9,
                            maxOutputTokens: 600,
                            stopSequences: ["Repetir", "Lo mismo", "De nuevo"]
                        }
                    })
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;

                if (aiResponse.toLowerCase().includes("no entiendo")) {
                    throw new Error("Respuesta no comprendida");
                }

                conversationHistory.push(
                    { role: "user", parts: [{ text: message }] },
                    { role: "model", parts: [{ text: aiResponse }] }
                );

                if (conversationHistory.length > 6) {
                    conversationHistory = conversationHistory.slice(-6);
                }

                const formattedResponse = aiResponse
                    .replace(/\n/g, '<br>')
                    .replace(/(\d+\.)/g, '<strong>$1</strong>');

                chatBody.innerHTML += `<div class="bot-message">${formattedResponse}</div>`;

            } catch (error) {
                console.error('Error:', error);
                const errorMessage = error.message.includes("no comprendida")
                    ? "¬øPodr√≠as reformular tu pregunta? Quiero asegurarme de entenderte bien."
                    : "Estoy teniendo dificultades para responder. ¬øPodr√≠as intentar formularlo de otra manera?";

                chatBody.innerHTML += `<div class="bot-message">${errorMessage}</div>`;
            } finally {
                isProcessing = false;
                userInput.disabled = false;
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }

        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && !isProcessing) {
                e.preventDefault();
                sendMessage();
            }
        });

        // C√≥digo original del portal
        let exams = [{
                id: 1,
                title: "Matem√°ticas B√°sicas",
                duration: 30,
                questions: [
                    { question: "2 + 2 =", options: ["3", "4", "5", "6"], correct: 1 },
                    { question: "‚àö16 =", options: ["2", "3", "4", "5"], correct: 2 }
                ],
                status: "pending"
            },
                {
                    id: 2,
                    title: "Historia Universal",
                    duration: 45,
                    questions: [
                        { question: "A√±o descubrimiento Am√©rica", options: ["1492", "1502", "1487", "1510"], correct: 0 },
                        { question: "Primera guerra mundial", options: ["1914", "1905", "1939", "1945"], correct: 0 }
                    ],
                    status: "pending"
                },
                {
                    id: 3,
                    title: "Geograf√≠a Mundial",
                    duration: 25,
                    questions: [
                        { question: "Capital de Francia", options: ["Lyon", "Marsella", "Par√≠s", "Toulouse"], correct: 2 },
                        { question: "Pa√≠s m√°s grande del mundo", options: ["China", "Rusia", "Canad√°", "EE.UU"], correct: 1 }
                    ],
                    status: "pending"
                },
                {
                    id: 4,
                    title: "Gram√°tica Espa√±ola",
                    duration: 20,
                    questions: [
                        { question: "'Hab√≠a' es conjugaci√≥n de:", options: ["Haber", "Hacer", "Hablar", "Hallar"], correct: 0 },
                        { question: "Palabra aguda:", options: ["√Årbol", "Canci√≥n", "L√°piz", "Mesa"], correct: 1 }
                    ],
                    status: "pending"
                },
                {
                    id: 5,
                    title: "Qu√≠mica B√°sica",
                    duration: 35,
                    questions: [
                        { question: "S√≠mbolo del Oro", options: ["Au", "Ag", "Fe", "Cu"], correct: 0 },
                        { question: "pH del agua pura", options: ["5", "7", "8", "10"], correct: 1 }
                    ],
                    status: "pending"
                },
                {
                    id: 6,
                    title: "Inform√°tica General",
                    duration: 40,
                    questions: [
                        { question: "Lenguaje de marcado web", options: ["Java", "HTML", "Python", "C++"], correct: 1 },
                        { question: "Inventor de Linux", options: ["Bill Gates", "Linus Torvalds", "Steve Jobs", "Mark Zuckerberg"], correct: 1 }
                    ],
                    status: "pending"
                }];
        let grades = [];
        let currentExam = null;
        let timeLeft = 0;
        let timerInterval = null;

        // Obtener IP del usuario
            async function getClientIP() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'unknown-ip';
                }
            }

            // Cargar progreso guardado
            function loadProgress() {
                const savedData = localStorage.getItem('studentProgress');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        grades = data.grades || [];
                        exams = exams.map(exam => ({
                            ...exam,
                            status: data.completedExams.includes(exam.id) ? 'completed' : 'pending'
                        }));
                    } catch (e) {
                        console.error('Error loading progress:', e);
                    }
                }
            }

            // Guardar progreso
            async function saveProgress() {
                const progressData = {
                    grades: grades.map(grade => ({
                        ...grade,
                        date: new Date(grade.date).toISOString()
                    })),
                    completedExams: exams.filter(e => e.status === 'completed').map(e => e.id),
                    ip: await getClientIP(),
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('studentProgress', JSON.stringify(progressData));
            }

            // Navegaci√≥n
            function handleNavigation() {
                const hash = window.location.hash || "#dashboard";
                $('.nav-link').removeClass('active');
                $(`a[href="${hash}"]`).addClass('active');
                $('.section').removeClass('active');
                $(hash).addClass('active');
            }

            // Dashboard
            function initDashboard() {
                $('#upcoming-exams').html(exams.filter(e => e.status === 'pending')
                    .map(e => `<li class="list-group-item">${e.title} - ${e.duration} minutos</li>`).join(''));

                new Chart($('#performanceChart'), {
                    type: 'line',
                    data: {
                        labels: grades.map(g => new Date(g.date).toLocaleDateString()),
                        datasets: [{
                            label: 'Calificaciones',
                            data: grades.map(g => g.score),
                            borderColor: '#3498db'
                        }]
                    }
                });
            }

            // Cargar ex√°menes
            function loadExams() {
                $('#exam-list').html(exams.map(exam => `
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <h5>${exam.title}</h5>
                        <small>Duraci√≥n: ${exam.duration} minutos</small>
                        ${exam.status === 'completed' ?
                        '<div class="text-success mt-1"><i class="fas fa-check"></i> Completado</div>' : ''}
                    </div>
                    <button class="btn btn-primary btn-sm" 
                            ${exam.status === 'completed' ? 'disabled' : ''}
                            onclick="startExam(${exam.id})">
                        ${exam.status === 'completed' ? 'Examen Entregado' : 'Iniciar Examen'}
                    </button>
                </div>
            `).join(''));
            }

            // Iniciar examen
            function startExam(examId) {
                currentExam = exams.find(e => e.id === examId);
                timeLeft = currentExam.duration * 60;

                $('.timer').text(
                    `${Math.floor(timeLeft / 60).toString().padStart(2, '0')}:${(timeLeft % 60).toString().padStart(2, '0')}`
                ).show();

                $('#examTitle').text(currentExam.title);
                $('#examQuestions').html(`
                <div class="student-info mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="firstName" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="lastName" class="form-label">Apellido</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                    </div>
                </div>
                ${currentExam.questions.map((q, index) => `
                    <div class="question-card">
                        <h6>Pregunta ${index + 1}</h6>
                        <p>${q.question}</p>
                        ${q.options.map((o, i) => `
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="q${index}" 
                                       id="q${index}o${i}" value="${i}">
                                <label class="form-check-label" for="q${index}o${i}">
                                    ${o}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                `).join('')}
            `);

                $('#examModal').modal('show');
                startTimer();
            }

            // Temporizador
            function startTimer() {
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    $('.timer').text(
                        `${Math.floor(timeLeft / 60).toString().padStart(2, '0')}:${(timeLeft % 60).toString().padStart(2, '0')}`
                    );
                    if (timeLeft <= 0) submitExam();
                }, 1000);
            }

            // Entregar examen
            async function submitExam() {
                const firstName = $('#firstName').val().trim();
                const lastName = $('#lastName').val().trim();

                if (!firstName || !lastName) {
                    alert('Por favor ingresa tu nombre y apellido.');
                    return;
                }

                clearInterval(timerInterval);

                let score = 0;
                const results = currentExam.questions.map((q, index) => {
                    const selected = $(`input[name="q${index}"]:checked`).val();
                    const isCorrect = parseInt(selected) === q.correct;
                    if (isCorrect) score++;
                    return {
                        question: q.question,
                        userAnswer: q.options[selected] || "Sin responder",
                        correctAnswer: q.options[q.correct],
                        isCorrect: isCorrect
                    };
                });

                const finalScore = (score / currentExam.questions.length * 100).toFixed(1);
                const timeUsed = `${Math.floor((currentExam.duration * 60 - timeLeft) / 60)}:${(currentExam.duration * 60 - timeLeft) % 60}`.padStart(2, '0');

                showResults(results, finalScore, timeUsed, firstName, lastName);
                await saveGrade(firstName, lastName, finalScore);
            }

            // Mostrar resultados
            function showResults(results, score, timeUsed, firstName, lastName) {
                $('#finalScore').text(score);
                $('#timeUsed').text(timeUsed);
                $('#studentName').text(`${firstName} ${lastName}`);
                $('#resultsDetails').html(results.map((r, i) => `
                <div class="question-card ${r.isCorrect ? 'correct-answer' : 'incorrect-answer'}">
                    <h6>Pregunta ${i + 1}: ${r.question}</h6>
                    <p>Tu respuesta: ${r.userAnswer}</p>
                    <p>Respuesta correcta: ${r.correctAnswer}</p>
                </div>
            `).join(''));
                $('#examModal').modal('hide');
                $('#resultsModal').modal('show');
            }

            // Guardar calificaci√≥n
            async function saveGrade(firstName, lastName, score) {
                grades.push({
                    firstName,
                    lastName,
                    exam: currentExam.title,
                    score,
                    date: new Date().toISOString(),
                    ip: await getClientIP()
                });

                currentExam.status = 'completed';
                await saveProgress();
                updateGrades();
            }

            // Actualizar tabla
            function updateGrades() {
                $('#grades-table').html(grades.map(g => `
                <tr>
                    <td>${g.exam}</td>
                    <td>${g.score}%</td>
                    <td>${new Date(g.date).toLocaleDateString()}</td>
                </tr>
            `).join(''));
            }

            // Generar PDF
            function generatePDF() {
                if (grades.length === 0) {
                    alert('No hay calificaciones para exportar.');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const lastIP = grades[grades.length - 1]?.ip || 'No registrada';

                doc.setFontSize(18);
                doc.text('Historial de Calificaciones', 14, 22);
                doc.setFontSize(12);
                doc.text(`√öltima IP registrada: ${lastIP}`, 14, 28);

                doc.autoTable({
                    head: [['Nombre', 'Apellido', 'Examen', 'Calificaci√≥n', 'Fecha']],
                    body: grades.map(g => [
                        g.firstName,
                        g.lastName,
                        g.exam,
                        `${g.score}%`,
                        new Date(g.date).toLocaleDateString()
                    ]),
                    startY: 35,
                    theme: 'grid',
                    headStyles: { fillColor: [41, 128, 185], textColor: 255 },
                    margin: { horizontal: 10 }
                });

                doc.save('calificaciones.pdf');
            }

            // Inicializaci√≥n
            $(document).ready(() => {
                loadProgress();
                handleNavigation();
                initDashboard();
                loadExams();
                updateGrades();

                $(window).on('hashchange', handleNavigation);
                $('#examModal').on('hidden.bs.modal', () => {
                    clearInterval(timerInterval);
                    $('.timer').hide();
                });
            });

        // Mensaje inicial del chat
        window.onload = () => {
            document.getElementById('chatBody').innerHTML = `
                <div class="bot-message">
                    ¬°Hola! Soy tu tutor interactivo üéì<br>
                    Puedes preguntarme sobre:
                    <ul>
                        <li>Matem√°ticas: ecuaciones, f√≥rmulas, problemas</li>
                        <li>Espa√±ol: gram√°tica, redacci√≥n, literatura</li>
                        <li>Ingl√©s: vocabulario, gram√°tica, traducciones</li>
                    </ul>
                    ¬øEn qu√© puedo ayudarte hoy?
                </div>
            `;
        };

        $(document).ready(() => {
            loadProgress();
            handleNavigation();
            initDashboard();
            loadExams();
            updateGrades();

            $(window).on('hashchange', handleNavigation);
            $('#examModal').on('hidden.bs.modal', () => {
                clearInterval(timerInterval);
                $('.timer').hide();
            });
        });
    </script>
</body>

</html>
